
ALTER PROCEDURE [dbo].[CDSL_ExportDPAccount]
@fromdate varchar(20),
@todate varchar(20),
@ids varchar(max),
@authorizefor varchar(5),
@Userid varchar(10),
@Company varchar(500),
@BatchNumber varchar(10),
@SegmentID varchar(10)

-- exec [CDSL_ExportDPAccount] '2013-01-01','2015-04-04','Screen','L','A','377','''COS0000001'',''COP0000001'',''COM0000001'',''COt0000002'',''COR0000002''','','67'

-- exec [CDSL_ExportDPAccount] '2013-01-01','2015-04-04','74','U','457','''COR0000002''','009','81'



AS
BEGIN
Declare @sql varchar(max),@authorizeValue int,@Staticloopcounter bigint,@Maxloopcounter bigint,
@UpdatelinenumberCounter bigint,@TotalNoofRecords int
Select @TotalNoofRecords=count(*) from (select COL from dbo.fnSplitReturnTable(@ids,',')) as total
select @authorizeValue = max(GlobalSettings_Value) from Config_GlobalSettings 
where GlobalSettings_Name='GS_CDSLCLNTOPAUTH' and GlobalSettings_SegmentID=@SegmentID
	
	If (@ids='Screen')
		Begin-----------Details main record to show in main grid
			Select @sql='
			Select  CdslOfflineAccount_ID,Right(CdslOfflineAccount_DPID,6) as CdslOfflineAccount_DPID,
			''Cancel Batches'' as Cancelbatch ,ltrim(rtrim(isnull(CdslOfflineAccount_FirstName,'' '')))+'' ''+
			ltrim(rtrim(isnull(CdslOfflineAccount_MiddleName,'' '')))+'' ''+
			ltrim(rtrim(isnull(CdslOfflineAccount_LastName,'' ''))) as Clientname,
			CdslOfflineAccount_ApplicationNumber as CdslOfflineAccount_ApplicationNumber,
			isnull(Convert(varchar(11),CdslOfflineAccount_CreateDateTime,106),'''') as AppDate,
			isnull(CdslOfflineAccount_FirstName,'''') as fathername,
			isnull(Convert(varchar(11),CdslOfflineAccount_DateOfBirth,106),'''') as DOB,
			(select ltrim(rtrim(isnull(USER_name,'' '')))+'' [ ''+
			ltrim(rtrim(isnull(user_loginid,'' '')))+'' ] '' from tbl_master_user
			where user_id=CdslOfflineAccount_VerifyUser) as Verifyuser,
			case 
			when (CdslOfflineAccount_AuthorizeUser1 is null and CdslOfflineAccount_AuthorizeUser2 is null and CdslOfflineAccount_AuthorizeUser3 is null)
			then '''' when (CdslOfflineAccount_AuthorizeUser1 is not null and CdslOfflineAccount_AuthorizeUser2 is null and CdslOfflineAccount_AuthorizeUser3 is null)
			then  (select USER_NAME+'' [ ''+ user_loginid +'' ]'' from tbl_master_user where user_id=CdslOfflineAccount_AuthorizeUser1)  
			when (CdslOfflineAccount_AuthorizeUser1 is not null and CdslOfflineAccount_AuthorizeUser2 is not null and CdslOfflineAccount_AuthorizeUser3 is null)
			then (select USER_NAME+'' [ ''+ user_loginid +'' ]'' from tbl_master_user where user_id=CdslOfflineAccount_AuthorizeUser1) +'' , ''+
			(select USER_NAME+'' [ ''+ user_loginid +'' ]'' from tbl_master_user where user_id=CdslOfflineAccount_AuthorizeUser2)
			else (select USER_NAME+'' [ ''+ user_loginid +'' ]'' from tbl_master_user where user_id=CdslOfflineAccount_AuthorizeUser1) +'' , ''+
			(select USER_NAME+'' [ ''+ user_loginid +'' ]'' from tbl_master_user where user_id=CdslOfflineAccount_AuthorizeUser2) +'' , ''+
			(select USER_NAME+'' [ ''+ user_loginid +'' ]'' from tbl_master_user where user_id=CdslOfflineAccount_AuthorizeUser3)
			end as authorisedby,isnull(CdslOfflineAccount_BatchNumber,'' '') as batchnumber
			
			 from Trans_CDSLOfflineAccount
			where CdslOfflineAccount_CreateUser in (select USER_ID from tbl_master_user where user_EntryProfile in (''C'',''P'',''F''))
			and  (DATEADD(dd, 0, DATEDIFF(dd, 0, CdslOfflineAccount_CreateDateTime)) between '''+@fromdate+''' AND '''+@todate+''')
			and CdslOfflineAccount_CompanyID in ('+@Company+')
			and CdslOfflineAccount_VerifyUser is not null and CdslOfflineAccount_VerifyDateTime is not null 
			
			'
		If (@authorizefor='A')
			Begin
				Set @sql=@sql+' and CdslOfflineAccount_BatchDateTime is not null 
								and CdslOfflineAccount_BatchUser is not null
								and CdslOfflineAccount_BatchNumber is not null'
							   
			End
		If (@authorizefor='U')
			Begin
				Set @sql=@sql+' and CdslOfflineAccount_BatchDateTime is  null 
								and CdslOfflineAccount_BatchUser is  null
								and CdslOfflineAccount_BatchNumber is  null'
							   
			End
		If (@authorizeValue=1)
			Begin
				Set @sql=@sql+'	and CdslOfflineAccount_AuthorizeUser1 is not null 
								and CdslOfflineAccount_Authorize1DateTime is not null '
								
			End
		If (@authorizeValue=2)
			Begin
				Set @sql=@sql+'	and CdslOfflineAccount_AuthorizeUser1 is not null 
								and CdslOfflineAccount_Authorize1DateTime is not null
								and CdslOfflineAccount_AuthorizeUser2 is not null 
								and CdslOfflineAccount_Authorize2DateTime is not null 
								'
								
			End
		If (@authorizeValue=3)
			Begin
				Set @sql=@sql+'	and CdslOfflineAccount_AuthorizeUser1 is not null 
								and CdslOfflineAccount_Authorize1DateTime is not null
								and CdslOfflineAccount_AuthorizeUser2 is not null 
								and CdslOfflineAccount_Authorize2DateTime is not null 
								and CdslOfflineAccount_AuthorizeUser3 is not null 
								and CdslOfflineAccount_Authorize3DateTime is not null
								'
								
			End
			If(@authorizefor='U')
				Begin
						Select @sql=@sql+'  select 
											case when len(cast(isnull(max(ExportFiles_BatchNumber),0)+1 as varchar(5)))<3
											then Right(REPLICATE(''0'',3-len(cast(isnull(max(ExportFiles_BatchNumber),0)+1 as varchar(5))))+
											cast(isnull(max(ExportFiles_BatchNumber),0)+1 as varchar(5)),5)
											 else cast(isnull(max(ExportFiles_BatchNumber),0)+1 as varchar(5))end as batchnumber 
											from Trans_ExportFiles where ExportFiles_Type=''CDSLCLNTUPLD'''
				End

			Exec (@sql)
			If (@authorizefor='A')
			Begin
				set @sql=''
				select @sql='Select distinct ''Cancel Batches'' as Cancelbatch ,
							isnull(CdslOfflineAccount_BatchNumber,'' '') as batchnumber,
							COUNT(CdslOfflineAccount_BatchNumber) as counting
								 from Trans_CDSLOfflineAccount
								where CdslOfflineAccount_CreateUser in (select USER_ID from tbl_master_user where user_EntryProfile in (''C'',''P'',''F''))
								and  (DATEADD(dd, 0, DATEDIFF(dd, 0, CdslOfflineAccount_CreateDateTime)) between '''+@fromdate+''' AND '''+@todate+''')
								and CdslOfflineAccount_CompanyID in ('+@Company+')
								and CdslOfflineAccount_VerifyUser is not null 
								and CdslOfflineAccount_VerifyDateTime is not null 
								and CdslOfflineAccount_BatchDateTime is not null 
								and CdslOfflineAccount_BatchUser is not  null
								and CdslOfflineAccount_BatchNumber is not null '
		If (@authorizeValue=1)
			Begin
				Set @sql=@sql+'	and CdslOfflineAccount_AuthorizeUser1 is not null 
								and CdslOfflineAccount_Authorize1DateTime is not null '
								
			End
		If (@authorizeValue=2)
			Begin
				Set @sql=@sql+'	and CdslOfflineAccount_AuthorizeUser1 is not null 
								and CdslOfflineAccount_Authorize1DateTime is not null
								and CdslOfflineAccount_AuthorizeUser2 is not null 
								and CdslOfflineAccount_Authorize2DateTime is not null 
								'
								
			End
		If (@authorizeValue=3)
			Begin
				Set @sql=@sql+'	and CdslOfflineAccount_AuthorizeUser1 is not null 
								and CdslOfflineAccount_Authorize1DateTime is not null
								and CdslOfflineAccount_AuthorizeUser2 is not null 
								and CdslOfflineAccount_Authorize2DateTime is not null 
								and CdslOfflineAccount_AuthorizeUser3 is not null 
								and CdslOfflineAccount_Authorize3DateTime is not null
								'
								
			End
				Set @sql=@sql+' group by CdslOfflineAccount_BatchNumber '
						Exec (@sql)	   
			End
			
	End
		  
			
	Else-------------Export data Start from here
		Begin
			
			Declare @Loopcounterstaticforclient bigint,@Loopcounterincrementalforclient bigint,@CdslOfflineID varchar(10),
					@LoopCounterStaticforoth bigint,@LoopCounterincreamentelforoth bigint,@OthID bigint,@HeaderRecord varchar(25),
					@Operatorid varchar(6)
			Create Table #Clientinternalidinsert (Srlno int identity,Internalid varchar(max))
			Insert Into #Clientinternalidinsert
			select COL from dbo.fnSplitReturnTable(@ids,',')
			Select @Loopcounterincrementalforclient=Max(Srlno) From #Clientinternalidinsert
			Set @Loopcounterstaticforclient=1
			
			Create Table #Cdslother (Autoidoth int identity,OthID varchar(10))
			
			Create Table #CDSLMain1st 
			-----------Line number 02 First Account Holder
			(Autoid1 int identity,Cdsloflineid varchar(20),Linenumber varchar(10),Productno varchar (50),BoFirstName varchar(250),BoMiddleName varchar(250),
			BoLastName varchar(250),BoTittle varchar(250),BoSuffix varchar(250),[F/H Name] varchar(250),CustAddr1 varchar(250),CustAddr2 varchar(250),
			CustAddr3 varchar(250),CustCity varchar(250),CustState varchar(250),CustCountry varchar(250),CustZip varchar(250),CustPh1Indc varchar(250),
			CustPh1 varchar(250),CustPh2Indc varchar(250),CustPh2 varchar(250),CustAdditionalPh varchar(250),CustFax varchar(250),ITPan varchar(250),UID varchar(24),
			ITCircle varchar(250),CustEmail varchar(250),UserText1 varchar(250),UserText2 varchar(250),UserText3 varchar(250),PanExamtion varchar(250),PanVerification varchar(250),SignatureFlag varchar(250))
			
			----------Line Number 03 Second Account Holder
			Create Table #CDSLMain2nd(
			Autoid2 int identity,Cdsloflineid varchar(20),Linenumber2ndholder varchar(10),BoFirstName2ndholder varchar(250),BoMiddleName2ndholder varchar(250),BoLastName2ndholder varchar(250),BoTittle2ndholder varchar(250),BoSuffix2ndholder varchar(250),[F/H Name2ndholder] varchar(250),ITPan2ndholder varchar(250),UID2ndholder varchar(24),ITCircle2ndholder varchar(250))
			----------Line Number 04 Third Account Holder
			Create Table #CDSLMain3rd(
			Autoid3 int identity,Cdsloflineid varchar(20),Linenumber3rdholder varchar(10),BoFirstName3rdHolder varchar(250),BoMiddleName3rdHolder varchar(250),BoLastName3rdholder varchar(250),BoTittle3rdholder varchar(250),BoSuffix3rdholder varchar(250),[F/H Name3rdholder] varchar(250),ITPan3rdholder varchar(250),UID3rdholder varchar(24),ITCircle3rdholder varchar(250))
			----------Line Number 05 Product Detail
			Create Table #CDSLMain4th(
			Autoid4 int identity,Cdsloflineid varchar(20),LineNumber4thproduct varchar(10),DateofMaturity varchar(20),DpinternalRefno varchar(10),DateofBirth varchar(20),SexCode varchar(10),Occupation varchar(250),LifeStyle varchar(250),GeoCode varchar(250),EduDegree varchar(100),AnnualIncomeCode varchar(100),
			NationalityCode varchar(100),LegalStatusCode varchar(50),FeeType varchar(100),LanguageCode varchar(100),Category4Code varchar(50),BankOption varchar(50),StaffRelaTive varchar(100),StaffCode varchar(100),AlphaNumericCode1 varchar(10),
			RGessFlag varchar(100),[Annual Report Flag] varchar(50),[Pledge Standing Instruction Flag] varchar(50),[Email RTA Download Flag] varchar(50),[BSDA Flag] varchar(10),AlphaNumericCode2 varchar(50),NumericDummy1 varchar(250),NumericDummy2 varchar(250),
			NumericDummy3 varchar(250),[SECURITY ACCESS CODE] varchar(50),[BO CATEGORY] varchar(50),[BO SETTLEMENT PLANNING FLAG] varchar(50),[DIVIDEND BANK IFSC CODE] varchar(250),[RBI REFERENCE NUMBER] varchar(250),[RBI APPROVAL DATE] varchar(20),[SEBI REGISTRATION NUMBER] varchar(50),
			[BENEFICIARY TAX DEDUCTION STATUS] varchar(250),[Smart Card Required] varchar(50),[Smart Card Number] varchar(50),[Smart Card Pin] varchar(50),[ECS/MANDATE] varchar(250),[Electronic Confirmation] varchar(250),[Dividend Currency] varchar(50),[Group Code] varchar(50),[BO Sub Status] varchar(250),
			[Clearing Corporation ID] varchar(50),[Clearing Member ID] varchar(50),[Stock Exchange] varchar(250),[Confirmation Waved] varchar(255),[Trading ID] varchar(50),[BO Statement Cycle Code] varchar(50),Filler1Product varchar(2),Filler2Product varchar(2),Filler3Product varchar(2),Filler4Product varchar(2),
			[DIVND BANK ACCT TYPE] varchar(20),[DIVND BANK CODE] varchar(50),[DIVND ACCT NUMB] varchar(50),[DIVND BANK CCY] varchar(100))
			----------Line Number 06 POA Link Detail
			Create Table #CDSLMain5th(
			Autoid5 int identity,Cdsloflineid varchar(20),LineNumber05Poa varchar(10),[POA ID] varchar(50),[SetUp Date] varchar(20),[POA To Operate Ac] varchar(255),[GPB/BPA Flag] varchar(10),[Effective From Date] varchar(20),[Effective To Date] varchar(20),[User Field 1] varchar(2),[User Field 2] varchar(2),[CA CharFLD] varchar(500),[Filler 1 POA] char(1),[Filler 2 POA] char(1), 
			[Filler 3 POA] char(1),[Filler 4 POA] char(1),[Filler 5 POA] char(1),[Filler 6 POA] char(1),[Filler 7 POA] char(1),[Filler 8 POA] char(1),[Filler 9 POA] char(1),[Filler 10 POA] char(1),[Filler 11 POA] char(1),[Filler 12 POA] char(1),[Filler 13 POA] char(1),[Filler 14 POA] char(1),[Filler 15 POA] char(1),
			[Filler 16 POA] char(1),[Filler 17 POA] char(1),[Filler 18 POA] char(1),[Filler 19 POA] char(1),[Filler 20 POA] char(1),[Filler 21 POA] char(1),[Filler 22 POA] char(1),[Filler 23 POA] char(1),[UserText 1_POAID] varchar(16),[Filler 24 POA] char(1),[UserField3_POALinkPurCode] varchar(4),[Filler 25 POA] char(1),
			[Filler 26 POA] char(1),[Filler 27 POA] char(1))
			----------Line Number 07 Permanant Address Detail
			Create Table #CDSLMain6th(
			Autoid6 int identity,Cdsloflineid varchar(20),LineNumber06 varchar(10),[Purpose Code] char(2),[BO Name Add] varchar(255),[BO MIDDLE NAME Add] varchar(255),[LAST / SEARCH NAME Add] varchar(255),[BO TITLE] varchar(255),[BO SUFFIX] varchar(10),[FATHER / HUSBAND NAME] varchar(255),[ADDRESS LINE 1] varchar(255),[ADDRESS LINE 2] varchar(255),[ADDRESS LINE 3] varchar(255),
			CITY varchar(100),State varchar(100),Country varchar(100),Zip varchar(20),[PH 1 INDC] varchar(50),[PH 1] varchar(25),[PH 2 INDC] varchar(50),[PH 2] varchar(25),[ADDITIONAL PHONE] varchar(40),FAX varchar(400),[INCOME TAX PAN] varchar(40),[IT CIRCLE] varchar(50),[CUST E-MAIL] varchar(50),[USER TEXT 1] char(1),
			[USER TEXT 2] char(1),[USER FIELD 3] char(1),[USER FIELD 4] char(1),[USER FIELD 5] char(1))
			----------Line Number 08 Purpose Code 06 Nominee Name Detail
			Create Table #CDSLMain7th(
			Autoid7 int identity,Cdsloflineid varchar(20),[Line Number08] varchar(10),[Purpose Code06] char(2),[BO Name Nominee] varchar(255),[BO Middle Name Nominee] varchar(255),[LAST / SEARCH NAME Add Nom] varchar(255),[BO TITLE Nom] varchar(255),[BO SUFFIX Nom] varchar(10),[FATHER / HUSBAND NAME Nom] varchar(255),[ADDRESS LINE 1 Nom] varchar(255),[ADDRESS LINE 2 Nom] varchar(255),[ADDRESS LINE 3 Nom] varchar(255),
			[CITY Nom] varchar(100),[State Nom] varchar(100),[Country Nom] varchar(100),[Zip Nom] varchar(20),[PH 1 INDC Nom] varchar(50),[PH 1 Nom] varchar(25),[PH 2 INDC Nom] varchar(50),[PH 2 Nom] varchar(25),[ADDITIONAL PHONE Nom] varchar(40),[DateofBirth Nom] varchar(20) ,[FAX Nom] varchar(400),[INCOME TAX PAN Nom] varchar(40),UID varchar(25),[IT Circle] varchar(250),[CUST E-MAIL Nom] varchar(50),[USER TEXT 1 Nom] char(1),
			[USER TEXT 2 Nom] char(1),[USER FIELD 3 Nom] char(1),[USER FIELD 4 PanExemption Nom] char(1),[USER FIELD 5 Nom] char(1))
			----------Line Number 09 Purpose Code 07 Gurdian Name Detail
			Create Table #CDSLMain8th(
			Autoid8 int identity,Cdsloflineid varchar(20),[Line Number09]varchar(10),[Purpose Code07] char(2),[BO Name Gurdian] varchar(255),[BO Middle Name Gurdian] varchar(255),[LAST / SEARCH NAME Add Gurdian] varchar(255),[BO TITLE Gurdian] varchar(255),[BO SUFFIX Gurdian] varchar(10),[FATHER / HUSBAND NAME Gurdian] varchar(255),[ADDRESS LINE 1 Gurdian] varchar(255),[ADDRESS LINE 2 Gurdian] varchar(255),[ADDRESS LINE 3 Gurdian] varchar(255),
			[CITY Gurdian] varchar(100),[State Gurdian] varchar(100),[Country Gurdian] varchar(100),[Zip Gurdian] varchar(20),[PH 1 INDC Gurdian] varchar(50),[PH 1 Gurdian] varchar(25),[PH 2 INDC Gurdian] varchar(50),[PH 2 Nom] varchar(25),[ADDITIONAL PHONE Gurdian] varchar(40),[DateofBirth Gurdian] varchar(20) ,[FAX Gurdian] varchar(400),[INCOME TAX PAN Gurdian] varchar(40),UIDGur varchar(25),[IT Circle Gur] varchar(250),[CUST E-MAIL Gurdian] varchar(50),[USER TEXT 1 Gurdian] char(1),
			[USER TEXT 2 Gurdian] char(1),[USER FIELD 3 Gurdian] char(1),[USER FIELD 4 PanExemption Gurdian] char(1),[USER FIELD 5 Gurdian] char(1))
			----------Line Number 10 Purpose Code 08 Nominee Gurdian Name Detail
			Create Table #CDSLMain9th(
			Autoid9 int identity,Cdsloflineid varchar(20),[Line Number10]varchar(10),[Purpose Code08] char(2),[BO Name NomNomGurdian] varchar(255),[BO Middle Name NomGurdian] varchar(255),[LAST / SEARCH NAME Add NomGurdian] varchar(255),[BO TITLE NomGurdian] varchar(255),[BO SUFFIX NomGurdian] varchar(10),[FATHER / HUSBAND NAME NomGurdian] varchar(255),[ADDRESS LINE 1 NomGurdian] varchar(255),[ADDRESS LINE 2 NomGurdian] varchar(255),[ADDRESS LINE 3 NomGurdian] varchar(255),
			[CITY NomGurdian] varchar(100),[State NomGurdian] varchar(100),[Country NomGurdian] varchar(100),[Zip NomGurdian] varchar(20),[PH 1 INDC NomGurdian] varchar(50),[PH 1 NomGurdian] varchar(25),[PH 2 INDC NomGurdian] varchar(50),[PH 2 Nom] varchar(25),[ADDITIONAL PHONE NomGurdian] varchar(40),[DateofBirth NomGurdian] varchar(20) ,[FAX NomGurdian] varchar(400),[INCOME TAX PAN NomGurdian] varchar(40),UIDNomGur varchar(25),[IT Circle NomGur] varchar(250),[CUST E-MAIL NomGurdian] varchar(50),[USER TEXT 1 NomGurdian] char(1),
			[USER TEXT 2 NomGurdian] char(1),[USER FIELD 3 NomGurdian] char(1),[USER FIELD 4 PanExemption NomGurdian] char(1),[USER FIELD 5 NomGurdian] char(1))
			
			Create Table #MainExport(mainfield varchar(max))
			Create Table #FinalExport(Finalfield varchar(max))
			--Insert into #MainExport
			Select @Operatorid=ltrim(rtrim(isnull(GlobalSettings_DefaultNarration,''))) from Config_GlobalSettings where GlobalSettings_SegmentID=@SegmentID and GlobalSettings_Name='GS_CDSLOPERATORID'
			Select @HeaderRecord=( select Top 1 cast(right(CdslOfflineAccount_DPID,6)+left(@Operatorid+REPLICATE(' ',6),6)+right(REPLICATE('0',5)+cast(@TotalNoofRecords as varchar(5)),5)--cast(@TotalNoofRecords as varchar(10)) 
			as varchar(max))from Trans_CDSLOfflineAccount)
			While (@Loopcounterstaticforclient<=@Loopcounterincrementalforclient)
				Begin------------Client Loop Begin
				
				Select @CdslOfflineID=Internalid from #Clientinternalidinsert where Srlno=@Loopcounterstaticforclient
					Insert Into #CDSLMain1st
					
					Select @CdslOfflineID,'02',(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
					where CdslStaticData_FieldName='BO Product Code' 
					and CdslOfflineAccount_ProductNumber=CdslStaticData_ID),CdslOfflineAccount_FirstName,CdslOfflineAccount_MiddleName,CdslOfflineAccount_LastName,
					CdslOfflineAccount_Title,CdslOfflineAccount_Suffix,CdslOfflineAccount_FatherName,CdslOfflineAccount_Address1,CdslOfflineAccount_Address2,
					CdslOfflineAccount_Address3,
					(select top 1 ltrim(rtrim(city_name)) from tbl_master_city where city_id=CdslOfflineAccount_City),
					(select top 1 ltrim(rtrim(state)) from tbl_master_state where id=CdslOfflineAccount_State),
					(select top 1 ltrim(rtrim(cou_country)) from tbl_master_country where cou_id=CdslOfflineAccount_Country),
					CdslOfflineAccount_Zip,
					CdslOfflineAccount_Phone1Ind,
					case when CdslOfflineAccount_Phone1='0' then '' else CdslOfflineAccount_Phone1 end,CdslOfflineAccount_Phone2Ind,
					case when CdslOfflineAccount_Phone2='0' then '' else CdslOfflineAccount_Phone2 end,CdslOfflineAccount_AdditionalPhone,
					CdslOfflineAccount_Fax,CdslOfflineAccount_PAN,CdslOfflineAccount_UID,CdslOfflineAccount_ITCircle,CdslOfflineAccount_EmailID,CDSLOfflineAccount_UserText1,
					CDSLOfflineAccount_UserText2,CDSLOfflineAccount_UserText3,
					case when isnull(CdslOfflineAccount_PANExempt,'')='N' then '' else 
					(select top 1 CdslStaticData_TypeCode from Master_PANExemptCategory,Master_CdslStaticDataCode
					where CdslStaticData_ID=PanExemptCategory_CdslID and CdslStaticData_FieldName='PAN Exemption Code' 
					and CdslOfflineAccount_PANExemptType=PanExemptCategory_ID) end,
					
					--(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
					--where CdslStaticData_FieldName='PAN Verification Code' 
					--and CdslOfflineAccount_PANVerification=CdslStaticData_ID)
					case when (len(ltrim(rtrim(isnull(CdslOfflineAccount_PAN,''))))>0 and
					len(ltrim(rtrim(isnull(CdslOfflineAccount_SecondHolderPAN,''))))>0 
					and len(ltrim(rtrim(isnull(CdslOfflineAccount_ThirdHolderPAN,''))))>0) 
					then '1110'
					when (len(ltrim(rtrim(isnull(CdslOfflineAccount_PAN,''))))>0 and
					len(ltrim(rtrim(isnull(CdslOfflineAccount_SecondHolderPAN,''))))>0 
					and len(ltrim(rtrim(isnull(CdslOfflineAccount_ThirdHolderPAN,''))))=0) 
					then '1100'
					when (len(ltrim(rtrim(isnull(CdslOfflineAccount_PAN,''))))>0 and
					len(ltrim(rtrim(isnull(CdslOfflineAccount_SecondHolderPAN,''))))=0 
					and len(ltrim(rtrim(isnull(CdslOfflineAccount_ThirdHolderPAN,''))))=0) 
					then '1000'
					end
					--'1000'
					,isnull(CdslOfflineAccount_SignatureFlag,'')
					from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID-- in (select COL from dbo.fnSplitReturnTable(@ids,','))
					
					IF Exists(select CdslOfflineAccount_SecondHolderName from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID and len(ISNULL(CdslOfflineAccount_SecondHolderName,''))>0)
						Begin
							Insert Into #CDSLMain2nd
							
							Select @CdslOfflineID,'03',CdslOfflineAccount_SecondHolderName,CdslOfflineAccount_SecondHolderMiddleName,CdslOfflineAccount_SecondHolderLastName,
							CdslOfflineAccount_SecondHolderTitle,CdslOfflineAccount_SecondHolderSuffix,CdslOfflineAccount_SecondHolderFatherName,
							CdslOfflineAccount_SecondHolderPAN,CdslOfflineAccount_SecondHolderUID,CdslOfflineAccount_SecondHolderITCircle
							
							from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID
						
						End
					IF Exists(select CdslOfflineAccount_ThirdHolderName from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID and len(ISNULL(CdslOfflineAccount_ThirdHolderName,''))>0)
						Begin
							Insert Into #CDSLMain3rd
							Select @CdslOfflineID,'04',CdslOfflineAccount_ThirdHolderName,CdslOfflineAccount_ThirdHolderMiddleName,CdslOfflineAccount_ThirdHolderLastName,
							CdslOfflineAccount_ThirdHolderTitle,CdslOfflineAccount_ThirdHolderSuffix,CdslOfflineAccount_ThirdHolderFatherName,
							CdslOfflineAccount_ThirdHolderPAN,CdslOfflineAccount_ThirdHolderUID,CdslOfflineAccount_ThirdHolderITCircle
							from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID
							
						End
						
							Insert Into #CDSLMain4th---------Product Detail
							Select @CdslOfflineID,'05',
							case when right(REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_DateOfMaturity, 103), '/', ''),4)='1900'
							then null else REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_DateOfMaturity, 103), '/', '') end,
							CdslOfflineAccount_ID,
							case when right(REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_DateOfBirth, 103), '/', ''),4)='1900'
							then null else REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_DateOfBirth, 103), '/', '') end,
							CdslOfflineAccount_Sex,
							(select top 1 CdslStaticData_TypeCode from tbl_master_profession,Master_CdslStaticDataCode
							where CdslStaticData_id=PRO_CdslID and CdslStaticData_FieldName='Occupation Code' 
							and CdslOfflineAccount_OccupationCode=pro_id),
							CdslOfflineAccount_LifeStyleCode,
							(select top 1 CdslStaticData_TypeCode from Master_Geographical,Master_CdslStaticDataCode
							where CdslStaticData_id=Geographical_CdslID and CdslStaticData_FieldName='Geographical Code' 
							and CdslOfflineAccount_GeographicalCode=Geographical_id),
							(select top 1 CdslStaticData_TypeCode from tbl_master_education,Master_CdslStaticDataCode
							where CdslStaticData_id=edu_CdslID and CdslStaticData_FieldName='Education / Degree' 
							and CdslOfflineAccount_EducationCode=edu_id),
							(select top 1 CdslStaticData_TypeCode from Master_AnnualIncome,Master_CdslStaticDataCode
							where CdslStaticData_id=AnnualIncome_CdslID and CdslStaticData_FieldName='Annual Income Code' 
							and CdslOfflineAccount_IncomeCode=AnnualIncome_id),
							--(select top 1 CdslStaticData_TypeCode from Master_Nationality,Master_CdslStaticDataCode
							--where CdslStaticData_id=Nationality_CDSLid and CdslStaticData_FieldName='Nationality Code' 
							--and CdslOfflineAccount_Nationality=Nationality_id),
							(Select isnull(TypeCode,'') from 
							 (Select Country_CDSLID CdslID from Trans_CDSLOfflineAccount,tbl_master_country
							 Where cou_id=CdslOfflineAccount_Nationality and CdslOfflineAccount_ID=@CdslOfflineID) CdslOfflineAccount_Country
							 Left Outer Join
							 (Select CdslStaticData_TypeCode TypeCode,CdslStaticData_ID from Master_CdslStaticDataCode Where CdslStaticData_FieldName='Nationality Code') CdslstaticData
							 on CdslID=CdslStaticData_ID),
							(select top 1 CdslStaticData_TypeCode from tbl_master_legalStatus,Master_CdslStaticDataCode
							where CdslStaticData_id=lgl_CdslID and CdslStaticData_FieldName='BO Status' 
							and CdslOfflineAccount_LegalStatus=lgl_id),
							CdslOfflineAccount_FeeType,
							(select top 1 CdslStaticData_TypeCode from master_language,Master_CdslStaticDataCode
							where CdslStaticData_id=Language_cdslId and CdslStaticData_FieldName='Language Code' --Language_CdslID
							and CdslOfflineAccount_LanguageCode=Language_ID),
							CDSLOfflineAccount_Category4Code,CdslOfflineAccount_BankOption,
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='Staff / Relative Code' and CdslOfflineAccount_StaffRelative=CdslStaticData_ID),
							[CdslOfflineAccount_StaffCode],CDSLOfflineAccount_AlphaNumericCode1,CdslOfflineAccount_RGESS,
							CdslOfflineAccount_AnnualReportFlag,CdslOfflineAccount_PledgeSIFlag,CdslOfflineAccount_EmailRTADownloadFlag,
							CdslOfflineAccount_BSDAFlag,CDSLOfflineAccount_AlphaNumericCode2,CDSLOfflineAccount_NumericDummy1,
							CDSLOfflineAccount_NumericDummy2,CDSLOfflineAccount_NumericDummy3,
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='Security Type' and CdslOfflineAccount_SecurityAccessCode=CdslStaticData_ID),
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='BO Category' and CdslOfflineAccount_BOCategory=CdslStaticData_ID),
							CdslOfflineAccount_SettlementPlanningFlag,CdslOfflineAccount_DivBankIFSC,CdslOfflineAccount_RBIReference,
							case when len(rtrim(ltrim(isnull(CdslOfflineAccount_RBIReference,''))))>0 then
							REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_RBIApprovalDate, 103), '/', '')
							else '' end,CdslOfflineAccount_SEBIRegNumber,
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='Tax Deduction Status' and CdslOfflineAccount_TaxDeductionStatus=CdslStaticData_ID),
							case when CdslOfflineAccount_SmartCard='N' then '' else CdslOfflineAccount_SmartCard end,
							case when CdslOfflineAccount_SmartCard='N' then '' else CdslOfflineAccount_SmartCardNumber end ,
							case when CdslOfflineAccount_SmartCard='N' then 0 else CdslOfflineAccount_SmartCardPIN end ,
							CdslOfflineAccount_ECSMandate,CdslOfflineAccount_ElectronicConfirmation,
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='Account Currency' and CdslOfflineAccount_DivCurrency=CdslStaticData_ID),
							CdslOfflineAccount_GroupCode,
							(select top 1 CdslStaticData_SubTypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='BO Status/Sub-Status' and CdslOfflineAccount_BOSubStatus=CdslStaticData_ID),
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='Clearing House Id' and CdslOfflineAccount_ClearingCorpID=CdslStaticData_ID),
							CdslOfflineAccount_ClearingMemberID,CdslOfflineAccount_StockExchange,CdslOfflineAccount_ConfirmationWaived,
							CdslOfflineAccount_TradingID,
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='BO Statement Cycle Code' and CdslOfflineAccount_StatementCycleCode=CdslStaticData_ID),
							'','','','',
							(select top 1 CdslStaticData_TypeCode from Master_CdslStaticDataCode
							where CdslStaticData_FieldName='Bank account Type' and CdslOfflineAccount_DivBankAccountType=CdslStaticData_ID),
							CdslOfflineAccount_DivBankMICR,CdslOfflineAccount_DivBankAccountNumber,
							(select top 1 CdslStaticData_TypeCode from Master_Currency,Master_CdslStaticDataCode
							where CdslStaticData_id=Currency_CDSLID and CdslStaticData_FieldName='Account Currency' 
							and CdslOfflineAccount_DivBankCurrency=Currency_ID)
							from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID
							
					If Exists(Select * from Trans_CdslOfflinePOA where CdslOfflinePOA_MainID=@CdslOfflineID and ISNULL(CdslOfflinePOA_POAID,0)<>0)
						Begin
							
										insert into #CDSLMain5th----POA
										select @CdslOfflineID,'06',CdslOfflinePOA_POAID,
										--case when right(REPLACE(CONVERT(CHAR(10), GETDATE(), 103), '/', ''),4)='1900'
										--then null else REPLACE(CONVERT(CHAR(10), GETDATE(), 103), '/', '') end,--setupdate
										
										case when right(REPLACE(CONVERT(CHAR(10), CdslOfflinePOA_EffectiveFrom, 103), '/', ''),4)='1900'
										then null else REPLACE(CONVERT(CHAR(10), CdslOfflinePOA_EffectiveFrom, 103), '/', '') end,--setupdate
										CdslOfflinePOA_OperateAccount,CdslOfflinePOA_GPABPA,
										case when right(REPLACE(CONVERT(CHAR(10), CdslOfflinePOA_EffectiveFrom, 103), '/', ''),4)='1900'
										then null else REPLACE(CONVERT(CHAR(10), CdslOfflinePOA_EffectiveFrom, 103), '/', '') end ,--CdslOfflinePOA_EffectiveFrom
										case when right(REPLACE(CONVERT(CHAR(10), CdslOfflinePOA_EffectiveUntil, 103), '/', ''),4)='1900'
										then null else REPLACE(CONVERT(CHAR(10), CdslOfflinePOA_EffectiveUntil, 103), '/', '') end,
										
										'','',ltrim(rtrim(isnull(CdslOfflinePOA_Remarks,''))),'','','','','','','','','','','','','',
										'','','','','','','','','','',LTRIM(rtrim(isnull(CdslOfflinePOA_POAID,''))),'',
										case when CdslOfflinePOA_PurposeCode=1 then '0001'
										when CdslOfflinePOA_PurposeCode=2 then '0002'
										when CdslOfflinePOA_PurposeCode=3 then '0003' end
										,'','',''
									    from Trans_CdslOfflinePOA 
									    where CdslOfflinePOA_MainID=@CdslOfflineID
										
								
						End-------POA Exists Condition End
							Insert Into #CDSLMain6th
								Select @CdslOfflineID,'07','12',CdslOfflineAccount_FirstName,CdslOfflineAccount_MiddleName,
								CdslOfflineAccount_LastName,CdslOfflineAccount_Title,CdslOfflineAccount_Suffix,
								CdslOfflineAccount_FatherName,CdslOfflineAccount_PermAddress1,CdslOfflineAccount_PermAddress2,
								CdslOfflineAccount_PermAddress3,
								(select top 1 ltrim(rtrim(city_name)) from tbl_master_city where city_id=CdslOfflineAccount_PermCity),
								(select top 1 ltrim(rtrim(state)) from tbl_master_state where id=CdslOfflineAccount_PermState),
								(select top 1 ltrim(rtrim(cou_country)) from tbl_master_country where cou_id=CdslOfflineAccount_PermCountry),
								CdslOfflineAccount_PermZIP,CdslOfflineAccount_Phone1Ind,
								case when CdslOfflineAccount_Phone1='0' then '' else CdslOfflineAccount_Phone1 end,CdslOfflineAccount_Phone2Ind,
								case when CdslOfflineAccount_Phone2='0' then '' else CdslOfflineAccount_Phone2 end,CdslOfflineAccount_AdditionalPhone,CdslOfflineAccount_Fax,CdslOfflineAccount_PAN,
								CdslOfflineAccount_ITCircle,CdslOfflineAccount_EmailID,'','','','',''
							    from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID
							    
					If Exists(Select * from Trans_CDSLOfflineNominee where CDSLOfflineNominee_MainID=@CdslOfflineID and LEN(ISNULL(CdslOfflineNominee_FirstName,''))>0)
						Begin
										
										insert into #CDSLMain7th----Nominee
										select @CdslOfflineID,'08','06',CdslOfflineNominee_FirstName,CdslOfflineNominee_MiddleName,
										CdslOfflineNominee_LastName,CdslOfflineNominee_Title,CdslOfflineNominee_Suffix,
										CdslOfflineNominee_FatherName,CdslOfflineNominee_Address1,CdslOfflineNominee_Address2,
										CdslOfflineNominee_Address3,
										(select top 1 ltrim(rtrim(city_name)) from tbl_master_city where city_id=CdslOfflineNominee_City),
										(select top 1 ltrim(rtrim(state)) from tbl_master_state where id=CdslOfflineNominee_State),
										(select top 1 ltrim(rtrim(cou_country)) from tbl_master_country where cou_id=CdslOfflineNominee_Country),
										CdslOfflineNominee_Zip,CdslOfflineNominee_Phone1Ind,
										case when CdslOfflineNominee_Phone1='0' then '' else CdslOfflineNominee_Phone1 end,CdslOfflineNominee_Phone2Ind,
										case when CdslOfflineNominee_Phone2='0' then '' else CdslOfflineNominee_Phone2 end,CdslOfflineNominee_AdditionalPhone,
										case when right(REPLACE(CONVERT(CHAR(10), CdslOfflineNominee_DOB, 103), '/', ''),4)='1900'
										then null else REPLACE(CONVERT(CHAR(10), CdslOfflineNominee_DOB, 103), '/', '') end ,
										--REPLACE(CONVERT(CHAR(10), CdslOfflineNominee_DOB, 103), '/', ''),
										CdslOfflineNominee_Fax,CdslOfflineNominee_PAN,CdslOfflineNominee_UID,CdslOfflineNominee_ITCircle,CdslOfflineNominee_EmailID,
										CDSLOfflineNominee_UserText1,CDSLOfflineNominee_UserText2,CDSLOfflineNominee_UserText3,CDSLOfflineNominee_UserText4,CDSLOfflineNominee_UserText5
									    from Trans_CDSLOfflineNominee --where CDSLOfflineNominee_ID=@OthID
										where CdslOfflineNominee_MainID=@CdslOfflineID
									
						End-------Nominee Exists Condition End
					If Exists(select * from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID and LEN(CdslOfflineAccount_GuardianFirstName)>0)
						Begin
							insert into #CDSLMain8th
								Select @CdslOfflineID,'09','07',CdslOfflineAccount_GuardianFirstName,CdslOfflineAccount_GuardianMiddleName,CdslOfflineAccount_GuardianLastName,
								CdslOfflineAccount_GuardianTitle,CdslOfflineAccount_GuardianSuffix,CdslOfflineAccount_GuardianFatherName,CdslOfflineAccount_GuardianAddress1,
								CdslOfflineAccount_GuardianAddress2,CdslOfflineAccount_GuardianAddress3,
								(select top 1 ltrim(rtrim(city_name)) from tbl_master_city where city_id=CdslOfflineAccount_GuardianCity),
								(select top 1 ltrim(rtrim(state)) from tbl_master_state where id=CdslOfflineAccount_GuardianState),
								(select top 1 ltrim(rtrim(cou_country)) from tbl_master_country where cou_id=CdslOfflineAccount_GuardianCountry),
								CdslOfflineAccount_GuardianZip,CdslOfflineAccount_GuardianPhone1Ind,
								case when CdslOfflineAccount_GuardianPhone1='0' then '' else CdslOfflineAccount_GuardianPhone1 end,CdslOfflineAccount_GuardianPhone2Ind,
								case when CdslOfflineAccount_GuardianPhone2='0' then '' else CdslOfflineAccount_GuardianPhone2 end,CdslOfflineAccount_GuardianAdditionalPhone,
								case when right(REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_GuardianDOB, 103), '/', ''),4)='1900'
								then null else REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_GuardianDOB, 103), '/', '') end ,
								--REPLACE(CONVERT(CHAR(10), CdslOfflineAccount_GuardianDOB, 103), '/', ''),
								CdslOfflineAccount_GuardianFax,CdslOfflineAccount_GuardianPAN,CdslOfflineAccount_GuardianUID,CdslOfflineAccount_GuardianITCircle,CdslOfflineAccount_GuardianEmailID,
								CDSLOfflineAccount_GuardianUserText1,CDSLOfflineAccount_GuardianUserText2,CDSLOfflineAccount_GuardianUserText3,CDSLOfflineAccount_GuardianUserText4,CDSLOfflineAccount_GuardianUserText5
								from Trans_CDSLOfflineAccount where CdslOfflineAccount_ID=@CdslOfflineID
						End
					If Exists(Select * from Trans_CDSLOfflineNominee where CDSLOfflineNominee_MainID=@CdslOfflineID and len(isnull(CdslOfflineNominee_GuardianFirstName,''))>0)
						Begin
							insert into #CDSLMain9th
								Select @CdslOfflineID,'10','08',CdslOfflineNominee_GuardianFirstName,CdslOfflineNominee_GuardianMiddleName,CdslOfflineNominee_GuardianLastName,
										CdslOfflineNominee_GuardianTitle,CdslOfflineNominee_GuardianSuffix,CdslOfflineNominee_GuardianFatherName,CdslOfflineNominee_GuardianAddress1,
										CdslOfflineNominee_GuardianAddress2,CdslOfflineNominee_GuardianAddress3,
										(select top 1 ltrim(rtrim(city_name)) from tbl_master_city where city_id=CdslOfflineNominee_GuardianCity),
										(select top 1 ltrim(rtrim(state)) from tbl_master_state where id=CdslOfflineNominee_GuardianState),
										(select top 1 ltrim(rtrim(cou_country)) from tbl_master_country where cou_id=CdslOfflineNominee_GuardianCountry),
										CdslOfflineNominee_GuardianZip,CdslOfflineNominee_GuardianPhone1Ind,
										case when CdslOfflineNominee_GuardianPhone1='0' then '' else CdslOfflineNominee_GuardianPhone1 end,CdslOfflineNominee_GuardianPhone2Ind,
										case when CdslOfflineNominee_GuardianPhone2='0' then '' else CdslOfflineNominee_GuardianPhone2 end,CdslOfflineNominee_GuardianAdditionalPhone,
										case when right(REPLACE(CONVERT(CHAR(10), CdslOfflineNominee_GuardianDOB, 103), '/', ''),4)='1900'
										then null else REPLACE(CONVERT(CHAR(10), CdslOfflineNominee_GuardianDOB, 103), '/', '') end ,
										--REPLACE(CONVERT(CHAR(10), CdslOfflineNominee_GuardianDOB, 103), '/', ''),
										CdslOfflineNominee_GuardianFax,CdslOfflineNominee_GuardianPAN,CdslOfflineNominee_GuardianUID,CdslOfflineNominee_GuardianITCircle,CdslOfflineNominee_GuardianEmailID,
										CDSLOfflineNominee_GuardianUserText1,CDSLOfflineNominee_GuardianUserText2,CDSLOfflineNominee_GuardianUserText3,CDSLOfflineNominee_GuardianUserText4,CDSLOfflineNominee_GuardianUserText5
										from Trans_CDSLOfflineNominee --where CDSLOfflineNominee_ID=@OthID
								where CDSLOfflineNominee_ID=@CdslOfflineID   
						End
						update Trans_CDSLOfflineAccount set CdslOfflineAccount_BatchNumber=@BatchNumber,
														CdslOfflineAccount_BatchUser=@Userid,
														CdslOfflineAccount_BatchDateTime=GETDATE()
												where CdslOfflineAccount_ID=@CdslOfflineID
						insert into #MainExport
							select '01'+right(REPLICATE('0',3)+cast(@Loopcounterstaticforclient as varchar(4)),4)
						Union all
							select cast(cast(Linenumber as varchar(10))+isnull(right(REPLICATE('0',4)+cast(Productno as varchar(4)),4),'')+Left(ISNULL(BoFirstName,'')+REPLICATE(' ',100),100)+Left(ISNULL(BoMiddleName,'')+REPLICATE(' ',20),20)+
									Left(ISNULL(BoLastName,'')+REPLICATE(' ',20),20)+Left(ISNULL(BoTittle,'')+REPLICATE(' ',10),10)+Left(ISNULL(BoSuffix,'')+REPLICATE(' ',10),10)+Left(ISNULL([F/H Name],'')+REPLICATE(' ',50),50)+Left(ISNULL(CustAddr1,'')+REPLICATE(' ',30),30)+Left(ISNULL(CustAddr2,'')+REPLICATE(' ',30),30)+
									Left(ISNULL(CustAddr3,'')+REPLICATE(' ',30),30)+Left(ISNULL(CustCity,'')+REPLICATE(' ',25),25)+Left(ISNULL(CustState,'')+REPLICATE(' ',25),25)+Left(ISNULL(CustCountry,'')+REPLICATE(' ',25),25)+Left(ISNULL(CustZip,'')+REPLICATE(' ',10),10)+Left(ISNULL(CustPh1Indc,'')+REPLICATE(' ',1),1)+
									Left(ISNULL(CustPh1,'')+REPLICATE(' ',17),17)+Left(ISNULL(CustPh2Indc,'')+REPLICATE(' ',1),1)+Left(ISNULL(CustPh2,'')+REPLICATE(' ',17),17)+Left(ISNULL(CustAdditionalPh,'')+REPLICATE(' ',100),100)+Left(ISNULL(CustFax,'')+REPLICATE(' ',17),17)+Left(ISNULL(ITPan,'')+REPLICATE(' ',10),10)+Left(ISNULL(UID,'')+REPLICATE(' ',15),15)+
									Left(ISNULL(ITCircle,'')+REPLICATE(' ',15),15)+Left(ISNULL(CustEmail,'')+REPLICATE(' ',50),50)+Left(ISNULL(UserText1,'')+REPLICATE(' ',50),50)+Left(ISNULL(UserText2,'')+REPLICATE(' ',50),50)+right(REPLICATE('0',4)+cast(UserText3 as varchar(4)),4)+Left(ISNULL(PanExamtion,'')+REPLICATE(' ',4),4)+right(REPLICATE('0',4)+cast(isnull(PanVerification,'0') as varchar(4)),4)+
									Left(ISNULL(SignatureFlag,'')+REPLICATE(' ',1),1) as varchar(max))  
								from #CDSLMain1st where Cdsloflineid=@CdslOfflineID
						Union all
							Select CAST(cast(Linenumber2ndholder as varchar(10))+Left(ISNULL(BoFirstName2ndholder,'')+REPLICATE(' ',100),100)+Left(ISNULL(BoMiddleName2ndholder,'')+REPLICATE(' ',20),20)+Left(ISNULL(BoLastName2ndholder,'')+REPLICATE(' ',20),20)+
									Left(ISNULL(BoTittle2ndholder,'')+REPLICATE(' ',10),10)+Left(ISNULL(BoSuffix2ndholder,'')+REPLICATE(' ',10),10)+Left(ISNULL([F/H Name2ndholder],'')+REPLICATE(' ',50),50)+Left(ISNULL(ITPan2ndholder,'')+REPLICATE(' ',10),10)+Left(ISNULL(UID2ndholder,'')+REPLICATE(' ',15),15)+
									Left(ISNULL(ITCircle2ndholder,'')+REPLICATE(' ',15),15)  as varchar(max))
						   from #CDSLMain2nd where Cdsloflineid=@CdslOfflineID 
					    Union all
							Select CAST(cast(Linenumber3rdholder as varchar(10))+Left(ISNULL(BoFirstName3rdHolder,'')+REPLICATE(' ',100),100)+Left(ISNULL(BoMiddleName3rdHolder,'')+REPLICATE(' ',20),20)+Left(ISNULL(BoLastName3rdholder,'')+REPLICATE(' ',20),20)+
									Left(ISNULL(BoTittle3rdholder,'')+REPLICATE(' ',10),10)+Left(ISNULL(BoSuffix3rdholder,'')+REPLICATE(' ',10),10)+Left(ISNULL([F/H Name3rdholder],'')+REPLICATE(' ',50),50)+Left(ISNULL(ITPan3rdholder,'')+REPLICATE(' ',10),10)+Left(ISNULL(UID3rdholder,'')+REPLICATE(' ',15),15)
									+Left(ISNULL(ITCircle3rdholder,'')+REPLICATE(' ',15),15) as varchar(max)) 
							from #CDSLMain3rd where Cdsloflineid=@CdslOfflineID
						Union all
							Select CAST(cast(LineNumber4thproduct as varchar(10))+Left(ISNULL(DateofMaturity,'')+REPLICATE('0',8),8)+Left(ISNULL(DpinternalRefno,'')+REPLICATE(' ',10),10)+Left(ISNULL(DateofBirth,'')+REPLICATE(' ',8),8)+Left(ISNULL(SexCode,'')+REPLICATE(' ',1),1)+Left(ISNULL(Occupation,'')+REPLICATE(' ',4),4)+Left(ISNULL(LifeStyle,'')+REPLICATE(' ',4),4)+Left(ISNULL(GeoCode,'')+REPLICATE(' ',4),4)+Left(ISNULL(EduDegree,'')+REPLICATE(' ',4),4)+
									right(REPLICATE('0',4)+cast(isnull(AnnualIncomeCode,'0') as varchar(4)),4)+Left(ISNULL(NationalityCode,'')+REPLICATE(' ',3),3)+right(REPLICATE('0',2)+cast(isnull(LegalStatusCode,'0') as varchar(2)),2)+right(REPLICATE('0',2)+cast(isnull(FeeType,'0') as varchar(2)),2)+right(REPLICATE('0',2)+cast(isnull(LanguageCode,'0') as varchar(2)),2)+right(REPLICATE('0',2)+cast(isnull(Category4Code,'0') as varchar(2)),2)+
									right(REPLICATE('0',2)+cast(isnull(BankOption,'0') as varchar(2)),2)+Left(ISNULL(StaffRelaTive,'')+REPLICATE(' ',1),1)+
									Left(ISNULL(StaffCode,'')+REPLICATE(' ',10),10)+Left(ISNULL(AlphaNumericCode1,'')+REPLICATE(' ',45),45)+Left(ISNULL(RGessFlag,'')+REPLICATE(' ',1),1)+
									Left(ISNULL([Annual Report Flag],'')+REPLICATE(' ',1),1)+Left(ISNULL([Pledge Standing Instruction Flag],'')+REPLICATE(' ',1),1)+Left(ISNULL([Email RTA Download Flag],'')+REPLICATE(' ',1),1)+Left(ISNULL([BSDA Flag],'')+REPLICATE(' ',1),1)+
									Left(ISNULL(AlphaNumericCode2,'')+REPLICATE(' ',50),50)+right(REPLICATE('0',4)+cast(isnull(NumericDummy1,'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull(NumericDummy2,'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull(NumericDummy3,'0') as varchar(4)),4)+
									right(REPLICATE('0',2)+cast(isnull([SECURITY ACCESS CODE],'0') as varchar(2)),2)+right(REPLICATE('0',2)+cast(isnull([BO CATEGORY],'0') as varchar(2)),2)+Left(ISNULL([BO SETTLEMENT PLANNING FLAG],'')+REPLICATE(' ',1),1)+
									Left(ISNULL([DIVIDEND BANK IFSC CODE],'')+REPLICATE(' ',15),15)+Left(ISNULL([RBI REFERENCE NUMBER],'')+REPLICATE(' ',30),30)+Left(ISNULL([RBI APPROVAL DATE],'')+REPLICATE('0',8),8)+Left(ISNULL([SEBI REGISTRATION NUMBER],'')+REPLICATE(' ',24),24)+right(REPLICATE('0',2)+cast(isnull([BENEFICIARY TAX DEDUCTION STATUS],'0') as varchar(2)),2)+isnull([Smart Card Required],' ')+
									Left(ISNULL([Smart Card Number],'')+REPLICATE(' ',20),20)+right(REPLICATE('0',10)+cast(isnull([Smart Card Pin],'0') as varchar(10)),10)+isnull([ECS/MANDATE],' ')+isnull([Electronic Confirmation],' ')+right(REPLICATE('0',6)+cast(isnull([Dividend Currency],'0') as varchar(6)),6)+Left(ISNULL([Group Code],'')+REPLICATE(' ',8),8)+right(REPLICATE('0',4)+cast(isnull([BO Sub Status],'0') as varchar(4)),4)+
									right(REPLICATE('0',4)+cast(isnull([Clearing Corporation ID],'0') as varchar(4)),4)+Left(ISNULL([Clearing Member ID],'')+REPLICATE(' ',8),8)+right(REPLICATE('0',2)+cast(isnull([Stock Exchange],'0') as varchar(2)),2)+isnull([Confirmation Waved],' ')+Left(ISNULL([Trading ID],'')+REPLICATE(' ',8),8)+Left(ISNULL([BO Statement Cycle Code],'')+REPLICATE(' ',2),2)+
									Left(ISNULL(Filler1Product,'')+REPLICATE(' ',12),12)+
									Left(ISNULL(Filler2Product,'')+REPLICATE(' ',12),12)+Left(ISNULL(Filler3Product,'')+REPLICATE(' ',20),20)+right(REPLICATE('0',6)+cast(isnull(Filler4Product,'0') as varchar(6)),6)+Left(ISNULL([DIVND BANK ACCT TYPE],'')+REPLICATE(' ',12),12)+Left(ISNULL([DIVND BANK CODE],'')+REPLICATE(' ',12),12)+Left(ISNULL([DIVND ACCT NUMB],'')+REPLICATE(' ',20),20)+
									right(REPLICATE('0',6)+cast(isnull([DIVND BANK CCY],'0') as varchar(6)),6) as varchar(max))
									from #CDSLMain4th where Cdsloflineid=@CdslOfflineID
						Union all
							Select CAST(cast(LineNumber05Poa as varchar(10))+Left(ISNULL([POA ID],'')+REPLICATE(' ',16),16)+Left(ISNULL([SetUp Date],'')+REPLICATE('0',8),8)+isnull([POA To Operate Ac],' ')+isnull([GPB/BPA Flag],' ')+Left(ISNULL([Effective From Date],'')+REPLICATE('0',8),8)+Left(ISNULL([Effective To Date],'')+REPLICATE('0',8),8)+
									right(REPLICATE('0',4)+cast(isnull([User Field 1],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([User Field 2],'0') as varchar(4)),4)
									+Left(ISNULL([CA CharFLD],'')+REPLICATE(' ',50),50)+Left(ISNULL([Filler 1 POA],'')+REPLICATE(' ',100),100)+Left(ISNULL([Filler 2 POA],'')+REPLICATE(' ',20),20)+Left(ISNULL([Filler 3 POA],'')+REPLICATE(' ',20),20)+Left(ISNULL([Filler 4 POA],'')+REPLICATE(' ',10),10)+Left(ISNULL([Filler 5 POA],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([Filler 6 POA],'')+REPLICATE(' ',50),50)+Left(ISNULL([Filler 7 POA],'')+REPLICATE(' ',30),30)+Left(ISNULL([Filler 8 POA],'')+REPLICATE(' ',30),30)+Left(ISNULL([Filler 9 POA],'')+REPLICATE(' ',30),30)+Left(ISNULL([Filler 10 POA],'')+REPLICATE(' ',25),25)+Left(ISNULL([Filler 11 POA],'')+REPLICATE(' ',25),25)+
									Left(ISNULL([Filler 12 POA],'')+REPLICATE(' ',25),25)+Left(ISNULL([Filler 13 POA],'')+REPLICATE(' ',10),10)+
									isnull([Filler 14 POA],' ')+Left(ISNULL([Filler 15 POA],'')+REPLICATE(' ',17),17)+Left(ISNULL([Filler 16 POA],'')+REPLICATE(' ',1),1)+Left(ISNULL([Filler 17 POA],'')+REPLICATE(' ',17),17)+Left(ISNULL([Filler 18 POA],'')+REPLICATE(' ',100),100)+Left(ISNULL([Filler 19 POA],'')+REPLICATE(' ',17),17)+
									Left(ISNULL([Filler 20 POA],'')+REPLICATE(' ',10),10)+Left(ISNULL([Filler 21 POA],'')+REPLICATE(' ',15),15)+
									Left(ISNULL([Filler 22 POA],'')+REPLICATE(' ',15),15)+Left(ISNULL([Filler 23 POA],'')+REPLICATE(' ',50),50)+
									Left(ISNULL([UserText 1_POAID],'')+REPLICATE(' ',50),50)+Left(ISNULL([Filler 24 POA],'')+REPLICATE(' ',50),50)+
									right(REPLICATE('0',4)+cast(isnull(UserField3_POALinkPurCode,'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([Filler 25 POA],'0') as varchar(4)),4)+
									right(REPLICATE('0',4)+cast(isnull([Filler 26 POA],'0') as varchar(4)),4)+Left(ISNULL([Filler 27 POA],'')+REPLICATE(' ',1),1) as varchar(max)) 
									from #CDSLMain5th where Cdsloflineid=@CdslOfflineID
						Union all
							Select CAST(cast(LineNumber06 as varchar(10))+isnull([Purpose Code],'')+Left(ISNULL([BO Name Add],'')+REPLICATE(' ',100),100)+Left(ISNULL([BO MIDDLE NAME Add],'')+REPLICATE(' ',20),20)+Left(ISNULL([LAST / SEARCH NAME Add],'')+REPLICATE(' ',20),20)+
									Left(ISNULL([BO TITLE],'')+REPLICATE(' ',10),10)+Left(ISNULL([BO SUFFIX],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([FATHER / HUSBAND NAME],'')+REPLICATE(' ',50),50)+
									Left(ISNULL([ADDRESS LINE 1],'')+REPLICATE(' ',30),30)+Left(ISNULL([ADDRESS LINE 2],'')+REPLICATE(' ',30),30)+Left(ISNULL([ADDRESS LINE 3],'')+REPLICATE(' ',30),30)+
									Left(ISNULL(CITY,'')+REPLICATE(' ',25),25)+Left(ISNULL(State,'')+REPLICATE(' ',25),25)+Left(ISNULL(Country,'')+REPLICATE(' ',25),25)+
									Left(ISNULL(Zip,'')+REPLICATE(' ',10),10)+Left(ISNULL([PH 1 INDC],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 1],'')+REPLICATE(' ',17),17)+
									Left(ISNULL([PH 2 INDC],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 2],'')+REPLICATE(' ',17),17)+
									Left(ISNULL([ADDITIONAL PHONE],'')+REPLICATE(' ',100),100)+Left(ISNULL(FAX,'')+REPLICATE(' ',17),17)+
									Left(ISNULL([INCOME TAX PAN],'')+REPLICATE(' ',25),25)+Left(ISNULL([IT CIRCLE],'')+REPLICATE(' ',15),15)+
									Left(ISNULL([CUST E-MAIL],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 1],'')+REPLICATE(' ',50),50)+
									Left(ISNULL([USER TEXT 2],'')+REPLICATE(' ',50),50)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 3],'0') as varchar(4)),4)+
									right(REPLICATE('0',4)+cast(isnull([USER FIELD 4],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 5],'0') as varchar(4)),4) as varchar(max)) 
									from #CDSLMain6th where Cdsloflineid=@CdslOfflineID
						Union all
							Select CAST(cast([Line Number08] as varchar(10))+isnull([Purpose Code06],'')+Left(ISNULL([BO Name Nominee],'')+REPLICATE(' ',100),100)+
									Left(ISNULL([BO Middle Name Nominee],'')+REPLICATE(' ',20),20)+Left(ISNULL([LAST / SEARCH NAME Add Nom],'')+REPLICATE(' ',20),20)+
									Left(ISNULL([BO TITLE Nom],'')+REPLICATE(' ',10),10)+Left(ISNULL([BO SUFFIX Nom],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([FATHER / HUSBAND NAME Nom],'')+REPLICATE(' ',50),50)+Left(ISNULL([ADDRESS LINE 1 Nom],'')+REPLICATE(' ',30),30)+
									Left(ISNULL([ADDRESS LINE 2 Nom],'')+REPLICATE(' ',30),30)+Left(ISNULL([ADDRESS LINE 3 Nom],'')+REPLICATE(' ',30),30)+
									Left(ISNULL([CITY Nom],'')+REPLICATE(' ',25),25)+Left(ISNULL([State Nom],'')+REPLICATE(' ',25),25)+Left(ISNULL([Country Nom],'')+REPLICATE(' ',25),25)+Left(ISNULL([Zip Nom],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([PH 1 INDC Nom],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 1 Nom],'')+REPLICATE(' ',17),17)+Left(ISNULL([PH 2 INDC Nom],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 2 Nom],'')+REPLICATE(' ',17),17)+
									Left(ISNULL([ADDITIONAL PHONE Nom],'')+REPLICATE(' ',92),92)+Left(ISNULL([DateofBirth Nom],'')+REPLICATE('0',8),8)+Left(ISNULL([FAX Nom],'')+REPLICATE(' ',17),17)+Left(ISNULL([INCOME TAX PAN Nom],'')+REPLICATE(' ',10),10)+
									Left(ISNULL(UID,'')+REPLICATE(' ',15),15)+
									Left(ISNULL([IT Circle],'')+REPLICATE(' ',15),15)+Left(ISNULL([CUST E-MAIL Nom],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 1 Nom],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 2 Nom],'')+REPLICATE(' ',50),50)+
									right(REPLICATE('0',4)+cast(isnull([USER FIELD 3 Nom],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 4 PanExemption Nom],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 5 Nom],'0') as varchar(4)),4) as varchar(max))
									from #CDSLMain7th where Cdsloflineid=@CdslOfflineID
									
									
									
									
									
									
						Union all
							Select CAST(cast([Line Number09] as varchar(10))+isnull([Purpose Code07],'')+Left(ISNULL([BO Name Gurdian],'')+REPLICATE(' ',100),100)+Left(ISNULL([BO Middle Name Gurdian],'')+REPLICATE(' ',20),20)+Left(ISNULL([LAST / SEARCH NAME Add Gurdian],'')+REPLICATE(' ',20),20)+Left(ISNULL([BO TITLE Gurdian],'')+
									REPLICATE(' ',10),10)+Left(ISNULL([BO SUFFIX Gurdian],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([FATHER / HUSBAND NAME Gurdian],'')+REPLICATE(' ',50),50)+Left(ISNULL([ADDRESS LINE 1 Gurdian],'')+REPLICATE(' ',30),30)+
									Left(ISNULL([ADDRESS LINE 2 Gurdian],'')+REPLICATE(' ',30),30)+Left(ISNULL([ADDRESS LINE 3 Gurdian],'')+REPLICATE(' ',30),30)+
									Left(ISNULL([CITY Gurdian],'')+REPLICATE(' ',25),25)+Left(ISNULL([State Gurdian],'')+REPLICATE(' ',25),25)+Left(ISNULL([Country Gurdian],'')+REPLICATE(' ',25),25)+Left(ISNULL([Zip Gurdian],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([PH 1 INDC Gurdian],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 1 Gurdian],'')+REPLICATE(' ',17),17)+Left(ISNULL([PH 2 INDC Gurdian],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 2 INDC Gurdian],'')+REPLICATE(' ',17),17)+
									Left(ISNULL([ADDITIONAL PHONE Gurdian],'')+REPLICATE(' ',92),92)+Left(ISNULL([DateofBirth Gurdian],'')+REPLICATE(' ',8),8)+Left(ISNULL([FAX Gurdian],'')+REPLICATE(' ',17),17)+Left(ISNULL([INCOME TAX PAN Gurdian],'')+REPLICATE(' ',10),10)+
									Left(ISNULL(UIDGur,'')+REPLICATE(' ',15),15)+
									Left(ISNULL([IT Circle Gur],'')+REPLICATE(' ',15),15)+Left(ISNULL([CUST E-MAIL Gurdian],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 1 Gurdian],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 2 Gurdian],'')+REPLICATE(' ',50),50)+
									right(REPLICATE('0',4)+cast(isnull([USER FIELD 3 Gurdian],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 4 PanExemption Gurdian],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 5 Gurdian],'0') as varchar(4)),4) as varchar(max))
									from #CDSLMain8th where Cdsloflineid=@CdslOfflineID
									
									
									
						Union all
							Select CAST(cast([Line Number10] as varchar(10))+isnull([Purpose Code08],'')+Left(ISNULL([BO Name NomNomGurdian],'')+REPLICATE(' ',100),100)+
									Left(ISNULL([BO Middle Name NomGurdian],'')+REPLICATE(' ',20),20)+Left(ISNULL([LAST / SEARCH NAME Add NomGurdian],'')+REPLICATE(' ',20),20)+
									Left(ISNULL([BO TITLE NomGurdian],'')+REPLICATE(' ',10),10)+Left(ISNULL([BO SUFFIX NomGurdian],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([FATHER / HUSBAND NAME NomGurdian],'')+REPLICATE(' ',50),50)+Left(ISNULL([ADDRESS LINE 1 NomGurdian],'')+REPLICATE(' ',30),30)+
									Left(ISNULL([ADDRESS LINE 2 NomGurdian],'')+REPLICATE(' ',30),30)+Left(ISNULL([ADDRESS LINE 3 NomGurdian],'')+REPLICATE(' ',30),30)+
									Left(ISNULL([CITY NomGurdian],'')+REPLICATE(' ',25),25)+Left(ISNULL([State NomGurdian],'')+REPLICATE(' ',25),25)+Left(ISNULL([Country NomGurdian],'')+REPLICATE(' ',25),25)+Left(ISNULL([Zip NomGurdian],'')+REPLICATE(' ',10),10)+
									Left(ISNULL([PH 1 INDC NomGurdian],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 1 NomGurdian],'')+REPLICATE(' ',17),17)+Left(ISNULL([PH 2 INDC NomGurdian],'')+REPLICATE(' ',1),1)+Left(ISNULL([PH 2 Nom],'')+REPLICATE(' ',17),17)+
									Left(ISNULL([ADDITIONAL PHONE NomGurdian],'')+REPLICATE(' ',92),92)+Left(ISNULL([DateofBirth NomGurdian],'')+REPLICATE(' ',8),8)+Left(ISNULL([FAX NomGurdian],'')+REPLICATE(' ',17),17)+Left(ISNULL([INCOME TAX PAN NomGurdian],'')+REPLICATE(' ',10),10)+
									Left(ISNULL(UIDNomGur,'')+REPLICATE(' ',15),15)+
									Left(ISNULL([IT Circle NomGur],'')+REPLICATE(' ',15),15)+Left(ISNULL([CUST E-MAIL NomGurdian],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 1 NomGurdian],'')+REPLICATE(' ',50),50)+Left(ISNULL([USER TEXT 2 NomGurdian],'')+REPLICATE(' ',50),50)+
									right(REPLICATE('0',4)+cast(isnull([USER FIELD 3 NomGurdian],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 4 PanExemption NomGurdian],'0') as varchar(4)),4)+right(REPLICATE('0',4)+cast(isnull([USER FIELD 5 NomGurdian],'0') as varchar(4)),4) as varchar(max))
									from #CDSLMain9th where Cdsloflineid=@CdslOfflineID
						Set @Loopcounterstaticforclient=@Loopcounterstaticforclient+1
				End------------Client Loop End
				
			exec CDSL_ExportDPAccount @fromdate,@todate,'Screen','U',@Userid,@Company,@BatchNumber,@SegmentID
			--insert into #FinalExport
			--select * from #CDSLMain4th
			select @HeaderRecord
			union all
			select * from #MainExport
			--select * from #MainExport
			--Select * from #FinalExport
			Drop Table #CDSLMain1st
			Drop Table #CDSLMain2nd
			Drop Table #CDSLMain3rd
			Drop Table #CDSLMain4th
			Drop Table #CDSLMain5th
			Drop Table #CDSLMain6th
			Drop Table #CDSLMain7th
			Drop Table #CDSLMain8th
			Drop Table #CDSLMain9th
		End
--drop table #CDSLMain5th
			---------------Fetch Batch number-------------------
								
		
End	
	




		

