
ALTER PROCEDURE [dbo].[PULL_OTHERTRADES]
@CLIENTID VARCHAR(10),
@SEGMENT VARCHAR(10),
@COMPANYID VARCHAR(10),
@FROMDATE VARCHAR(20),
@TODATE VARCHAR(20),
@FINYEAR VARCHAR(12),
@OTHERCOMPANYID VARCHAR(10),
@OTHERSEGMENTID VARCHAR(10),
@CREATUSER INT

AS
BEGIN
SET NOCOUNT ON
Create table #AllEntrdRefID(RefID varchar(20))
--select * from Config_TradeCodeLink
--select * from [Trans_OtherTrades]
--select * from [Trans_OtherTradeCharges]
--EXEC PULL_OTHERTRADES 'CLS0001007','20','COG0000001','2010-05-21','2010-05-21','2010-2011','COR0000001','16','111'


				--Delete Previous Accounting On Same Data
				delete
				from Trans_AccountsLedger where AccountsLedger_ExchangeSegmentID=@SEGMENT 
				and AccountsLedger_TransactionReferenceID in (select JournalVoucher_VoucherNumber 
				from trans_journalvoucher where JournalVoucher_ExchangeSegmentID=@SEGMENT
				and JournalVoucher_SettlementNumber  in (select distinct OtherTrades_SettlementNumber 
				from Trans_OtherTrades where OtherTrades_CompanyID=@COMPANYID and OtherTrades_SegmentID=@SEGMENT
				and OtherTrades_OtherSegmentID=@OTHERSEGMENTID and OtherTrades_TradeDate between @FROMDATE and @TODATE))

				delete
				from Trans_JournalVoucherDetail where JournalVoucherDetail_ExchangeSegmentID=@SEGMENT
				and JournalVoucherDetail_VoucherNumber in (select JournalVoucher_VoucherNumber 
				from trans_journalvoucher where JournalVoucher_ExchangeSegmentID=@SEGMENT
				and JournalVoucher_SettlementNumber in (select distinct OtherTrades_SettlementNumber 
				from Trans_OtherTrades where OtherTrades_CompanyID=@COMPANYID and OtherTrades_SegmentID=@SEGMENT
				and OtherTrades_OtherSegmentID=@OTHERSEGMENTID and OtherTrades_TradeDate between @FROMDATE and @TODATE))

				Delete from trans_journalvoucher where JournalVoucher_ExchangeSegmentID=@SEGMENT
				and JournalVoucher_SettlementNumber 
				in (select distinct OtherTrades_SettlementNumber 
				from Trans_OtherTrades where OtherTrades_CompanyID=@COMPANYID and OtherTrades_SegmentID=@SEGMENT
				and OtherTrades_OtherSegmentID=@OTHERSEGMENTID and OtherTrades_TradeDate between @FROMDATE and @TODATE)
				and JournalVoucher_TransactionDate between @FROMDATE and @TODATE


				
								
				
			----------------DELTEE TRADES
			DELETE
			FROM [Trans_OtherTrades]
			WHERE 
			[OtherTrades_FinYear]=@FINYEAR
			AND [OtherTrades_CompanyID]=@COMPANYID
			AND [OtherTrades_SegmentID]=@SEGMENT
			AND OtherTrades_CustomerID=@CLIENTID
			AND OtherTrades_OtherCompanyID=@OTHERCOMPANYID
			AND OtherTrades_OtherSegmentID=@OTHERSEGMENTID
			AND [OtherTrades_TradeDate] BETWEEN @FROMDATE AND @TODATE
			AND [OtherTrades_TransactionType]='PULLD'

			DECLARE @EXCHSEGMENTNAME VARCHAR(20),@EXCHSEGMENTID INT
			SELECT @EXCHSEGMENTNAME=CASE WHEN EXCH_SEGMENTID='CM' AND EXCH_EXCHID='EXN0000002' THEN 'NSE-CM'
										 WHEN EXCH_SEGMENTID='CM' AND EXCH_EXCHID='EXB0000001' THEN 'BSE-CM'
										 WHEN EXCH_SEGMENTID='FO' AND EXCH_EXCHID='EXN0000002' THEN 'NSE-FO'
										 WHEN EXCH_SEGMENTID='FO' AND EXCH_EXCHID='EXB0000001' THEN 'BSE-FO'
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXM0000001' THEN 'MCX-COMM'
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXI0000001' THEN 'ICEX-COMM'
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXN0000004' THEN 'NCDEX-COMM'
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXN0000005' THEN 'NMCE-COMM'
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXD0000001' THEN 'DGCX-COMM'
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXM0000002' THEN 'MCXSX-CDX'
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXU0000001' THEN 'USE-CDX'
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXB0000001' THEN 'BSE-CDX'
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXN0000002' THEN 'NSE-CDX'
										 WHEN EXCH_SEGMENTID='SPOT' AND EXCH_EXCHID='EXN0000006' THEN 'NSEL-SPOT'
									 ELSE NULL END ,
				   @EXCHSEGMENTID =CASE  WHEN EXCH_SEGMENTID='CM' AND EXCH_EXCHID='EXN0000002' THEN 1
										 WHEN EXCH_SEGMENTID='CM' AND EXCH_EXCHID='EXB0000001' THEN 4
										 WHEN EXCH_SEGMENTID='FO' AND EXCH_EXCHID='EXN0000002' THEN 2
										 WHEN EXCH_SEGMENTID='FO' AND EXCH_EXCHID='EXB0000001' THEN 5
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXM0000001' THEN 7
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXI0000001' THEN 12
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXN0000004' THEN 9
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXN0000005' THEN 11
										 WHEN EXCH_SEGMENTID='COMM' AND EXCH_EXCHID='EXD0000001' THEN 10
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXM0000002' THEN 8
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXU0000001' THEN 13
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXB0000001' THEN 6
										 WHEN EXCH_SEGMENTID='CDX'  AND EXCH_EXCHID='EXN0000002' THEN 3
										 WHEN EXCH_SEGMENTID='SPOT' AND EXCH_EXCHID='EXN0000006' THEN 14
									 ELSE NULL END
			FROM TBL_MASTER_COMPANYEXCHANGE WHERE EXCH_INTERNALID=@OTHERSEGMENTID AND EXCH_COMPID=@OTHERCOMPANYID


			------------------INSERT INTO OTHER TRADES
			INSERT INTO [Trans_OtherTrades]
           ([OtherTrades_FinYear]
           ,[OtherTrades_CompanyID]
           ,[OtherTrades_SegmentID]
           ,[OtherTrades_BranchID]
           ,[OtherTrades_Exchange]
           ,[OtherTrades_ExchangeID]
           ,[OtherTrades_BrokerID]
           ,[OtherTrades_TradeCategory]
           ,[OtherTrades_SettlementNumber]
           ,[OtherTrades_SettlementType]
           ,[OtherTrades_TradeDate]
           ,[OtherTrades_PayInDate]
           ,[OtherTrades_PayOutDate]
           ,[OtherTrades_TransactionType]
           ,[OtherTrades_CustomerID]
           ,[OtherTrades_SecurityType]
           ,[OtherTrades_SecuritySymbol]
           ,[OtherTrades_SecuritySeries]
           ,[OtherTrades_SecurityCode]
           ,[OtherTrades_SecurityGroup]
           ,[OtherTrades_SecurityExpiry]
           ,[OtherTrades_StrikePrice]
           ,[OtherTrades_OptionType]
           ,[OtherTrades_QuantityLots]
           ,[OtherTrades_UnitPriceQuantity]
           ,[OtherTrades_UnitPrice]
           ,[OtherTrades_BrokerageType]
           ,[OtherTrades_BrokerageRate]
           ,[OtherTrades_UnitBrokerage]
           ,[OtherTrades_NetRatePerUnit]
           ,[OtherTrades_MarketValue]
           ,[OtherTrades_NetValue]
           ,[OtherTrades_TotalBrokerage]
           ,[OtherTrades_ServiceTaxMode]
           ,[OtherTrades_ServiceTaxOnBrkg]
           ,[OtherTrades_EduCessOnBrkg]
           ,[OtherTrades_HgrEduCessOnBrkg]
           ,[OtherTrades_ContractNoteType]
           ,[OtherTrades_ContractNoteNumber]
           ,[OtherTrades_Remarks]
           ,[OtherTrades_BillNumber]
           ,[OtherTrades_BillDate]
           ,[OtherTrades_IsLocked]
           ,[OtherTrades_SettPrice]
           ,[OtherTrades_AverageType]
           ,[OtherTrades_BrkgCalType]
           ,[OtherTrades_CreateUser]
           ,[OtherTrades_CreateDateTime]
		   ,OtherTrades_OtherCompanyID
		   ,OtherTrades_OtherSegmentID
		   ,OtherTrades_ProductSeriesid)
		
	SELECT 
			@FINYEAR
           ,@COMPANYID
           ,@SEGMENT
           ,CNT_BRANCHID
           ,@EXCHSEGMENTNAME
           ,@EXCHSEGMENTID
           ,TradeCodeLink_BrokerID
           ,CustomerTrades_TradeCategory
           ,CustomerTrades_SettlementNumber
           ,CustomerTrades_SettlementType
           ,CustomerTrades_TradeDate
           ,Settlements_StartDateTime
           ,Settlements_FundsPayout
           ,'PULLD'
           ,@CLIENTID
           ,Equity_FOIdentifier
           ,Equity_TickerSymbol
           ,Equity_Series
           ,Equity_TickerCode
           ,Equity_Group
           ,Equity_EffectUntil
           ,Equity_StrikePrice
           ,Equity_Series
           ,CustomerTrades_QuantityLots
           ,CustomerTrades_UnitPriceQuantity
           ,CustomerTrades_UnitPrice
           ,CustomerTrades_BrokerageType
           ,CustomerTrades_BrokerageRate
           ,CustomerTrades_UnitBrokerage
           ,CustomerTrades_NetRatePerUnit
           ,CustomerTrades_MarketValue
           ,CustomerTrades_NetValue
           ,CustomerTrades_TotalBrokerage
           ,CustomerTrades_ServiceTaxMode
           ,CustomerTrades_ServiceTaxOnBrkg
           ,CustomerTrades_EduCessOnBrkg
           ,CustomerTrades_HgrEduCessOnBrkg
           ,CustomerTrades_ContractNoteType
           ,CustomerTrades_ContractNoteNumber
           ,CustomerTrades_Remarks
           ,[CustomerTrades_BillNumber]
		   ,[CustomerTrades_BillDate]
		   ,[CustomerTrades_IsLocked]
           ,[CustomerTrades_SettPrice]
           ,[CustomerTrades_AverageType]
		   ,[CustomerTrades_BrkgCalType]
           ,@CREATUSER
           ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
		   ,@OTHERCOMPANYID
		   ,@OTHERSEGMENTID 
		   ,CUSTOMERTRADES_PRODUCTSERIESID

			FROM Config_TradeCodeLink,Trans_CustomerTrades,MASTER_EQUITY,TBL_MASTER_CONTACT,Master_Settlements
			WHERE CUSTOMERTRADES_PRODUCTSERIESID=EQUITY_SERIESID
			AND CNT_INTERNALID=@CLIENTID
			AND Ltrim(RTRIM(settlements_Number))=CustomerTrades_SettlementNumber
			AND ltrim(RTRIM(settlements_TypeSuffix))=CustomerTrades_SettlementType
			AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
			AND [CustomerTrades_FinYear]=@FINYEAR
			AND [CustomerTrades_CompanyID]=@OTHERCOMPANYID
			AND [CustomerTrades_ExchangeSegment]=@OTHERSEGMENTID
			AND CustomerTrades_TradeDate BETWEEN @FROMDATE AND @TODATE
			AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
			AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
			AND TradeCodeLink_CUSTOMERID=@CLIENTID 
			AND [CustomerTrades_CompanyID]=TradeCodeLink_OtherCompanyID
			AND [CustomerTrades_ExchangeSegment]=TradeCodeLink_OtherSegmentID
			AND [CustomerTrades_CustomerID]=TradeCodeLink_OtherCustomerID
			AND Isnull(Customertrades_TradeCategory,'TTT') NOT IN ('AUC')
          
			IF @EXCHSEGMENTID IN(1,4,2,5)
			BEGIN
			    Insert into #AllEntrdRefID
			    Select distinct OtherTrades_RefID from [Trans_OtherTrades] where OtherTrades_TransactionType='ENTRD' 
			    AND [OtherTrades_FinYear]=@FINYEAR
				AND [OtherTrades_CompanyID]=@COMPANYID
				AND [OtherTrades_SegmentID]=@SEGMENT
				AND OtherTrades_CustomerID=@CLIENTID
				AND [OtherTrades_TradeDate] BETWEEN @FROMDATE AND @TODATE
			
			    
			    DELETE
				FROM [Trans_OtherTradeCharges]
				WHERE 
				[OtherTradeCharges_FinYear]=@FINYEAR
				AND [OtherTradeCharges_CompanyID]=@COMPANYID
				AND [OtherTradeCharges_SegmentID]=@SEGMENT
				AND [OtherTradeCharges_CustomerID]=@CLIENTID
				AND [OtherTradeCharges_OtherCompanyID]=@OTHERCOMPANYID
				AND [OtherTradeCharges_OtherSegmentID]=@OTHERSEGMENTID
				AND [OtherTradeCharges_Date] BETWEEN @FROMDATE AND @TODATE
				AND OtherTradeCharges_EntryMode='PULLD' 
	
			
				IF @EXCHSEGMENTID IN(1,4)
				BEGIN  ------------------exchangsegment id (nse-cm,bse-cm) begin
			
				-----------------INSERT CHARGE
					INSERT INTO [Trans_OtherTradeCharges]
				   ([OtherTradeCharges_FinYear]
				   ,[OtherTradeCharges_CompanyID]
				   ,[OtherTradeCharges_SegmentID]
				   ,[OtherTradesCharges_BranchID]
				   ,[OtherTradeCharges_Exchange]
				   ,[OtherTradeCharges_ExchangeID]
				   ,[OtherTradeCharges_BrokerID]
				   ,[OtherTradeCharges_CustomerID]
				   ,[OtherTradeCharges_SettlementNumber]
				   ,[OtherTradeCharges_SettlementType]
				   ,[OtherTradeCharges_Date]
				   ,[OtherTradeCharges_Type]
				   ,[OtherTradeCharges_OtherChargeName]
				   ,[OtherTradeCharges_Amount]
				   ,[OtherTradeCharges_EntryMode]
				   ,[OtherTradeCharges_CreateUser]
				   ,[OtherTradeCharges_CreateDateTime]
				   ,[OtherTradeCharges_OtherCompanyID]
				   ,[OtherTradeCharges_OtherSegmentID])
					
					----------------STT
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'STT'
				   ,NULL
				   ,ISNULL(CMPositionSummary_STT,0)+ISNULL(CMPositionSummary_STTRoundOff,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_STT,0)+ISNULL(CMPositionSummary_STTRoundOff,0)<>0

					UNION ALL
					
					----------------TRANSACTION CHARGE
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'TRANCHRG'
				   ,NULL
				   ,ISNULL(CMPositionSummary_TranCharge,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_TranCharge,0)<>0


					UNION ALL
					
					----------------Stamp Duty
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'STAMPDUTY'
				   ,NULL
				   ,ISNULL(CMPositionSummary_StampDutyDlv,0)+isnull(CMPositionSummary_StampDutySqr,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_StampDutyDlv,0)+isnull(CMPositionSummary_StampDutySqr,0)<>0

					UNION ALL
					
					----------------SEBI Fee
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'SEBIFEE'
				   ,NULL
				   ,ISNULL(CMPositionSummary_SEBIFee,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_SEBIFee,0)<>0

					UNION ALL
					
					----------------Delivery Charge
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'DLVRYCHRG'
				   ,NULL
				   ,ISNULL(CMPositionSummary_DeliveryCharge,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_DeliveryCharge,0)<>0

					UNION ALL
					
					----------------Srv Tax Charges
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'Service Tax Charge'
				   ,NULL
				   ,ISNULL(CMPositionSummary_ServTaxOnBrokerage,0)+ISNULL(CMPositionSummary_ServTaxOnTranCharge,0)+isnull(CMPositionSummary_ServTaxOnDeliveryCharge,0)+isnull(CMPositionSummary_ServTaxOnOtherCharges,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_ServTaxOnBrokerage,0)+ISNULL(CMPositionSummary_ServTaxOnTranCharge,0)+isnull(CMPositionSummary_ServTaxOnDeliveryCharge,0)+isnull(CMPositionSummary_ServTaxOnOtherCharges,0)<>0

					UNION ALL

					---------------Edu Cess On Srv Tax Charges
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'Edu.Cess On Service Tax'
				   ,NULL
				   ,ISNULL(CMPositionSummary_EduCessOnBrokerage,0)+ISNULL(CMPositionSummary_EduCessOnTranCharge,0)+isnull(CMPositionSummary_EduCessOnDeliveryCharge,0)+isnull(CMPositionSummary_EduCessOnOtherCharges,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_EduCessOnBrokerage,0)+ISNULL(CMPositionSummary_EduCessOnTranCharge,0)+isnull(CMPositionSummary_EduCessOnDeliveryCharge,0)+isnull(CMPositionSummary_EduCessOnOtherCharges,0)<>0

					UNION ALL
					---------------Hgr Cess On Srv Tax Charges
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'Higher Edu.Cess On Service Tax'
				   ,NULL
				   ,ISNULL(CMPositionSummary_HgrEduCessOnBrokerage,0)+ISNULL(CMPositionSummary_HgrEduCessOnTranCharge,0)+isnull(CMPositionSummary_HgrEduCessOnDeliveryCharge,0)+isnull(CMPositionSummary_HgrEduCessOnOtherCharges,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND ISNULL(CMPositionSummary_HgrEduCessOnBrokerage,0)+ISNULL(CMPositionSummary_HgrEduCessOnTranCharge,0)+isnull(CMPositionSummary_HgrEduCessOnDeliveryCharge,0)+isnull(CMPositionSummary_HgrEduCessOnOtherCharges,0)<>0

					Union ALL
					----------------Net Round Off Amount
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,CMPositionSummary_SettlementNumber
				   ,CMPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'MISCRND'
				   ,NULL
				   ,isnull(CMPositionSummary_billroundoff,'0.000')
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_CMPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=CMPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=CMPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND CMPositionSummary_CompanyID=@OTHERCOMPANYID
					AND CMPositionSummary_SegmentID=@OTHERSEGMENTID
					AND CMPositionSummary_TradeDate BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND CMPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND CMPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND CMPositionSummary_CustomerID=TradeCodeLink_OtherCustomerID
					AND isnull(CMPositionSummary_billroundoff,'0.000')<>'0.000'

				END------------------exchangsegment id (nse-fo,bse-fo) end
				IF @EXCHSEGMENTID IN(2,5)
				BEGIN  
			
					-----------------INSERT CHARGE
					INSERT INTO [Trans_OtherTradeCharges]
				   ([OtherTradeCharges_FinYear]
				   ,[OtherTradeCharges_CompanyID]
				   ,[OtherTradeCharges_SegmentID]
				   ,[OtherTradesCharges_BranchID]
				   ,[OtherTradeCharges_Exchange]
				   ,[OtherTradeCharges_ExchangeID]
				   ,[OtherTradeCharges_BrokerID]
				   ,[OtherTradeCharges_CustomerID]
				   ,[OtherTradeCharges_SettlementNumber]
				   ,[OtherTradeCharges_SettlementType]
				   ,[OtherTradeCharges_Date]
				   ,[OtherTradeCharges_Type]
				   ,[OtherTradeCharges_OtherChargeName]
				   ,[OtherTradeCharges_Amount]
				   ,[OtherTradeCharges_EntryMode]
				   ,[OtherTradeCharges_CreateUser]
				   ,[OtherTradeCharges_CreateDateTime]
				   ,[OtherTradeCharges_OtherCompanyID]
				   ,[OtherTradeCharges_OtherSegmentID])
					
					----------------STT
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'STT'
				   ,NULL
				   ,ISNULL(FOPositionSummary_STT,0)+ISNULL(FOPositionSummary_STTRoundOff,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_STT,0)+ISNULL(FOPositionSummary_STTRoundOff,0)<>0

					UNION ALL
					
					----------------TRANSACTION CHARGE
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'TRANCHRG'
				   ,NULL
				   ,ISNULL(FOPositionSummary_TranCharges,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_TranCharges,0)<>0


					UNION ALL
					
					----------------Stamp Duty
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'STAMPDUTY'
				   ,NULL
				   ,ISNULL(FOPositionSummary_StampDuty,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_StampDuty,0)<>0

					UNION ALL
					
					----------------SEBI Fee
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'SEBIFEE'
				   ,NULL
				   ,ISNULL(FOPositionSummary_SEBIFee,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_SEBIFee,0)<>0

					UNION ALL
					
									
					----------------Srv Tax Charges
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'Service Tax Charge'
				   ,NULL
				   ,ISNULL(FOPositionSummary_ServiceTaxOnBrkg,0)+ISNULL(FOPositionSummary_ServiceTaxOnTranCharge,0)+isnull(FOPositionSummary_ServiceTaxOnOtherCharge,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_ServiceTaxOnBrkg,0)+ISNULL(FOPositionSummary_ServiceTaxOnTranCharge,0)+isnull(FOPositionSummary_ServiceTaxOnOtherCharge,0)<>0

					UNION ALL

					---------------Edu Cess On Srv Tax Charges
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'Edu.Cess On Service Tax'
				   ,NULL
				   ,ISNULL(FOPositionSummary_EduCessOnBrkg,0)+ISNULL(FOPositionSummary_EduCessOnTranCharge,0)+isnull(FOPositionSummary_EduCessOnOtherCharge,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_EduCessOnBrkg,0)+ISNULL(FOPositionSummary_EduCessOnTranCharge,0)+isnull(FOPositionSummary_EduCessOnOtherCharge,0)<>0

					UNION ALL
					---------------Hgr Cess On Srv Tax Charges
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'Higher Edu.Cess On Service Tax'
				   ,NULL
				   ,ISNULL(FOPositionSummary_HgrEduCessOnBrkg,0)+ISNULL(FOPositionSummary_HgrEduCessOnTranCharge,0)+isnull(FOPositionSummary_HgrEduCessOnOtherCharge,0)
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND ISNULL(FOPositionSummary_HgrEduCessOnBrkg,0)+ISNULL(FOPositionSummary_HgrEduCessOnTranCharge,0)+isnull(FOPositionSummary_HgrEduCessOnOtherCharge,0)<>0

					Union All
					----------------Net Round Off Amount
					SELECT 
					@FINYEAR
				   ,@COMPANYID
				   ,@SEGMENT
				   ,CNT_BRANCHID
				   ,@EXCHSEGMENTNAME
				   ,@EXCHSEGMENTID
				   ,TradeCodeLink_BrokerID
				   ,@CLIENTID
				   ,FOPositionSummary_SettlementNumber
				   ,FOPositionSummary_SettlementType
				   ,Settlements_StartDateTime
				   ,'MISCRND'
				   ,NULL
				   ,isnull(FOPositionSummary_roundoffamount,'0.000')
				   ,'PULLD'
				   ,@CREATUSER
				   ,cast(DATEADD(dd, 0, DATEDIFF(dd, 0,GETDATE())) as datetime)
				   ,@OTHERCOMPANYID
				   ,@OTHERSEGMENTID

					FROM Config_TradeCodeLink,Trans_FOPositionSummary,TBL_MASTER_CONTACT,Master_Settlements
					WHERE CNT_INTERNALID=@CLIENTID
					AND Ltrim(RTRIM(settlements_Number))=FOPositionSummary_SettlementNumber
					AND ltrim(RTRIM(settlements_TypeSuffix))=FOPositionSummary_SettlementType
					AND settlements_ExchangeSegmentId=@EXCHSEGMENTID
					AND FOPositionSummary_CompanyID=@OTHERCOMPANYID
					AND FOPositionSummary_SegmentID=@OTHERSEGMENTID
					AND FOPositionSummary_Date BETWEEN @FROMDATE AND @TODATE
					AND TradeCodeLink_OtherCompanyID=@OTHERCOMPANYID
					AND TradeCodeLink_OtherSegmentID=@OTHERSEGMENTID
					AND TradeCodeLink_CUSTOMERID=@CLIENTID 
					AND FOPositionSummary_CompanyID=TradeCodeLink_OtherCompanyID
					AND FOPositionSummary_SegmentID=TradeCodeLink_OtherSegmentID
					AND FOPositionSummary_CustomerExchangeID=TradeCodeLink_OtherCustomerID
					AND isnull(FOPositionSummary_roundoffamount,'0.000')<>'0.000'

				END

				--EXEC PULL_OTHERTRADESCHARGES @CLIENTID,@SEGMENT,@COMPANYID,@FROMDATE,@TODATE,@FINYEAR,@OTHERCOMPANYID,@OTHERSEGMENTID,@CREATUSER,@EXCHSEGMENTNAME,@EXCHSEGMENTID
				EXEC ACCOUNTING_OTHERTRADES @SEGMENT,@COMPANYID,@FROMDATE,@TODATE,@FINYEAR,'PULLD',@CREATUSER,@OTHERSEGMENTID
			END
			
END




--EXEC PULL_OTHERTRADES 'CLP0000485',47,'COP0000001','10-23-2012','10-23-2012','2012-2013','COR0000002','24','399'
